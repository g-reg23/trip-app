{% extends 'layout.html' %}

{% block body %}

    <div class="calInfo">
      <h5 class="calStart">{{ fullStartDate }}</h5>
      <h5 class="calEnd">{{ fullEndDate }}</h5>
    </div>
    <p>&nbsp</p>
    <div id="show_calendar" class='calendarClass'>&nbsp;</div>
    <div id="current_month">&nbsp;</div>

    <!-- <script src="{{url_for('static', filename = 'calendar.js')}}"></script> -->
    <script type="text/javascript" charset="utf-8">
    {
        let startDate = document.querySelector('.calStart');
        let today = new Date(startDate.innerHTML);
        let month = today.getMonth();

        Date.prototype.getMonths = function() {
          return [ 'January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December' ];
        }

        Date.prototype.getDays = function() {
            return new Date( this.getFullYear(), this.getMonth() + 1, 0 ).getDate();
        }

        Date.prototype.calendar = function() {
            let numOfDays = this.getDays();
            let startDay = new Date(this.getFullYear(), this.getMonth(), 1).getDay();
            let thisYear = this.getFullYear();
            let thisMonth = this.getMonths()[this.getMonth()];
            let calendarTable = document.createElement('table');
            calendarTable.className = 'calendar';
            let calSpan = document.createElement('span')
            calSpan.className = 'calTitle';
            calSpan.textContent = thisMonth + '  ' + thisYear;
            calendarTable.appendChild(calSpan);;
            let calDayRow = document.createElement('tr');
            calDayRow.className = 'dayRow'
            let calSun = document.createElement('td');
            calSun.textContent = 'SUN';
            calDayRow.appendChild(calSun)
            let calMon = document.createElement('td');
            calMon.textContent = 'MON';
            calDayRow.appendChild(calMon)
            let calTues = document.createElement('td');
            calTues.textContent = 'TUE';
            calDayRow.appendChild(calTues);
            let calWed = document.createElement('td');
            calWed.textContent = 'WED';
            calDayRow.appendChild(calWed);
            let calThurs = document.createElement('td');
            calThurs.textContent = 'THU';
            calDayRow.appendChild(calThurs);
            let calFri = document.createElement('td');
            calFri.textContent = 'FRI';
            calDayRow.appendChild(calFri);
            let calSat = document.createElement('td');
            calSat.textContent = 'SAT';
            calDayRow.appendChild(calSat);
            calendarTable.appendChild(calDayRow);

            let counter = 0;
            for (let i=0;i<6;i++) {
                let row = document.createElement('tr');
                for (let j=0;j<7;j++) {
                    let day = document.createElement('td');
                    if (counter>=numOfDays) {
                        day.textContent = '';
                        day.className = 'blankDay';
                    }else if (i===4 && counter>=numOfDays){
                        day.textContent = '';
                        day.className = 'blankDay';
                    }else if (i>0 || j>=startDay) {
                        counter++;
                        day.textContent = counter;
                        day.className = 'calDay';
                    }else if (i>4 && counter>numOfDays){
                        day.textContent = '';
                        day.className = 'blankDay';
                    }else{
                        day.textContent = '';
                        day.className = 'blankDay';
                    }
                    if (( month === this.getMonth()) && ( today.getDate() === counter)) {
                        day.classList = 'calDay';
                        day.id = 'firstDay'
                        let text = document.createTextNode('First Day of Trip!!');
                        let div = document.createElement('div');
                        div.classList = 'dayTitle';
                        div.appendChild(text);
                        day.appendChild(div);
                    }
                    row.appendChild(day);
                }
                calendarTable.appendChild(row);
                if (i===4 && counter===numOfDays) {break;}

            }
            return calendarTable;
        }

        window.onload = function() {
            let selected_month = '<form name="month_holder">';
            selected_month += '<select id="month_items" size="1" onchange="month_picker();">';
            for ( var x = 0; x <= today.getMonths().length; x++ ) {
                selected_month += '<option value="' + today.getMonths()[x] + ' 1, ' + today.getFullYear() + '">' + today.getMonths()[x] + '</option>'; }
            selected_month += '</select></form>';
            actual_calendar = document.getElementById('show_calendar');
            actual_calendar.appendChild(today.calendar());
            let month_list = document.querySelector('#current_month');
            month_list.innerHTML = selected_month;
            let actual_month = document.getElementById('month_items');
            actual_month.selectedIndex = month;
        }
        function month_picker() {
            month_menu = new Date(document.querySelector('#month_items').value);
            actual_calendar.innerHTML = '';
            actual_calendar.appendChild(month_menu.calendar());
        }
    }
    // Add Event Listeners
    document.querySelector('.calendarClass').addEventListener('click', dayNote);

    // Function to make a note on individual day
    function dayNote(e) {
        // e.target.style.padding = '7.5%'
        let date = e.target.textContent;
        if (e.target.className === 'calDay') {
            while (e.target.firstChild) {
                e.target.removeChild(e.target.firstChild);
            }
            if (e.target.id === 'firstDay') {
                let text = document.createTextNode('First Day of Trip!!');
                let div = document.createElement('div');
                div.className = 'dayTitle';
                div.appendChild(text);
                e.target.appendChild(div);
            }
            e.target.textContent = date;
            form = document.createElement('input');
            form.type = 'textarea';
            form.classList = 'sign-logInput calForm';
            form.style.height = '70%';
            // form.style.wrap = 'hard';
            submit = document.createElement('input');
            submit.type = 'submit';
            submit.classList = 'sign-logSubmit calSubmit'
            form.style.marginLeft = '2.5%';
            e.target.appendChild(form);
            // form.style.display = 'block';
            e.target.appendChild(submit);
            console.log(e.target);
        }else {
          return;
        }
        e.preventDefault();
    }
    </script type="text/javascript" charset="utf-8">



{% endblock %}
